---
import type { GetStaticPaths } from "astro";
import BlogLayout from "../../layouts/BlogLayout.astro";
import { getCollection } from "astro:content";
import "../../styles/global.css";
import { getImage, Image } from 'astro:assets';
import { getEntry } from "astro:content";
import { Formatter } from "../../utils/formatter";

export const getStaticPaths = (async() => {   
    const blogPosts = await getCollection('blog');
    return blogPosts.map ( post => ({
        params: {slug: post.slug},
        props: { post: post}
    }))
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const frontmatter = post.data;

const { Content, headings } = await post.render();

const author = await getEntry('author', post.data.author.id);
if (!author) {
  throw new Error('Author not found');
}

const { src } = await getImage({ src: author.data.avatar });
---


<BlogLayout title=" {post.data.title}">
    <h1 class="text-xs text-gray-500 mb-0">{ frontmatter.title }</h1>
    <div class="text-md text-gray-500 mb-0 flex flex-row mt-2">
     
            <img
                src={src}
                class="rounded-full"
                alt={author.data.name}
                width={50}
                height={50}
            />
   
    
    <div class="flex flex-col ml-5">
        <a href={`/blog/${ post.data.author.id }`}>{author.data.name}</a>
        <span class="text-md text-gray-400 mb-0">
            {Formatter.formatDate(frontmatter.date)}
        </span>
    </div>
    </div>

    <Image class="object-cover mt-10 mb-10 w-full h-56 rounded-lg lg:w-64" src={frontmatter.image} 
    alt={frontmatter.title}
    width={1200}
    height={220}
    quality="hight"
    loading="lazy"
    transition:name={`${post.slug}-image`}

    />

    <h3>Tabla de contenido</h3>
    <ol>
        {
        headings.map((heading, index) => (
            <li>
                <a href={`#${heading.slug}`}>

                    {index + 1} - {heading.text}
                </a>

            </li> 
        ))
        }
    </ol>
    <Content/>
    <div class="my-20">
        <a href="#btn-top">Ir arriba</a>
    </div>
</BlogLayout>